{% extends "base_admin.html" %}

{% block content %}
<div class="container py-4">
  <div class="d-flex justify-content-between align-items-center mb-4">
    <h1 class="h4 mb-0">‚öôÔ∏è Store Settings</h1>
    <a href="{{ url_for('store.index') }}" class="btn btn-outline-primary">
      üëÅÔ∏è View Store
    </a>
  </div>

  <form method="post" enctype="multipart/form-data">
    {{ form.hidden_tag() }}
    
    <!-- Store Information -->
    <div class="card mb-4">
      <div class="card-header">
        <h5 class="mb-0">Store Information</h5>
      </div>
      <div class="card-body">
        <div class="row g-3">
          <div class="col-md-6">
            <label class="form-label">Store Name *</label>
            {{ form.store_name(class="form-control", placeholder="Your Store Name") }}
            {% for error in form.store_name.errors %}
              <div class="form-text text-danger">{{ error }}</div>
            {% endfor %}
          </div>
          <div class="col-md-6">
            <label class="form-label">Tagline / Hero Text</label>
            {{ form.tagline(class="form-control", placeholder="Welcome to our amazing store!") }}
            {% for error in form.tagline.errors %}
              <div class="form-text text-danger">{{ error }}</div>
            {% endfor %}
          </div>
        </div>
      </div>
    </div>

    <!-- Contact Information -->
    <div class="card mb-4">
      <div class="card-header">
        <h5 class="mb-0">Contact Information</h5>
      </div>
      <div class="card-body">
        <div class="row g-3">
          <div class="col-md-6">
            <label class="form-label">Contact Email</label>
            {{ form.contact_email(class="form-control", placeholder="info@yourstore.com") }}
            {% for error in form.contact_email.errors %}
              <div class="form-text text-danger">{{ error }}</div>
            {% endfor %}
          </div>
          <div class="col-md-6">
            <label class="form-label">Phone Number</label>
            {{ form.phone(class="form-control", placeholder="+592 600 0000") }}
            {% for error in form.phone.errors %}
              <div class="form-text text-danger">{{ error }}</div>
            {% endfor %}
          </div>
          <div class="col-12">
            <label class="form-label">Address</label>
            {{ form.address(class="form-control", placeholder="123 Main St, Georgetown, Guyana") }}
            {% for error in form.address.errors %}
              <div class="form-text text-danger">{{ error }}</div>
            {% endfor %}
          </div>
        </div>
      </div>
    </div>

    <!-- Appearance -->
    <div class="card mb-4">
      <div class="card-header">
        <h5 class="mb-0">Appearance</h5>
      </div>
      <div class="card-body">
        <div class="row g-3">
          <div class="col-md-6">
            <label class="form-label">Theme Color</label>
            {{ form.theme_color(class="form-select") }}
            <div class="form-text">Choose the primary color scheme for your store</div>
          </div>
          <div class="col-md-6">
            <label class="form-label">Store Logo</label>
            {{ form.logo(class="form-control") }}
            <div class="form-text">JPG or PNG, max 2MB</div>
            {% for error in form.logo.errors %}
              <div class="form-text text-danger">{{ error }}</div>
            {% endfor %}
            {% if settings.logo_filename %}
              <div class="mt-2">
                <small class="text-muted">Current logo:</small><br>
                {% set logo_src = settings.logo_filename if settings.logo_filename.startswith('http') else url_for('uploaded_file', filename=settings.logo_filename) %}
                <img src="{{ logo_src }}" alt="Current Logo" style="height: 60px; margin-top: 8px;">
              </div>
            {% endif %}
          </div>
        </div>
      </div>
    </div>

    <!-- Payment Settings -->
    <div class="card mb-4">
      <div class="card-header">
        <h5 class="mb-0">Payment Settings</h5>
      </div>
      <div class="card-body">
        <div class="row g-3">
          <div class="col-md-6">
            <label class="form-label">PayPal Client ID</label>
            {{ form.paypal_client_id(class="form-control", placeholder="YOUR_PAYPAL_CLIENT_ID") }}
            <div class="form-text">Get this from your PayPal developer dashboard</div>
            {% for error in form.paypal_client_id.errors %}
              <div class="form-text text-danger">{{ error }}</div>
            {% endfor %}
          </div>
          <div class="col-md-6">
            <label class="form-label">MMG Instructions</label>
            {{ form.mmg_instructions(class="form-control", rows="3", placeholder="Contact us to arrange MMG payment...") }}
            <div class="form-text">Instructions shown to customers who select MMG payment</div>
            {% for error in form.mmg_instructions.errors %}
              <div class="form-text text-danger">{{ error }}</div>
            {% endfor %}
          </div>
        </div>
      </div>
    </div>

    <!-- Action Buttons -->
    <div class="d-flex gap-2">
      <button type="submit" class="btn btn-primary btn-lg">
        <span>üíæ Save Settings</span>
      </button>
      <a href="{{ url_for('admin.dashboard') }}" class="btn btn-secondary">
        <span>Cancel</span>
      </a>
    </div>
  </form>
</div>
{% endblock %}

{% block extra_scripts %}
<script>
document.addEventListener('DOMContentLoaded', function() {
  // Preview theme color changes
  const themeSelect = document.querySelector('select[name="theme_color"]');
  if (themeSelect) {
    themeSelect.addEventListener('change', function() {
      document.documentElement.className = 'theme-' + this.value;
    });
  }

  // Add loading state to form submit
  const form = document.querySelector('form');
  if (form) {
    form.addEventListener('submit', function() {
      const btn = this.querySelector('button[type="submit"]');
      if (btn) {
        btn.disabled = true;
        btn.innerHTML = '<span>üíæ Saving...</span>';
      }
    });
  }
});
</script>
{% endblock %}
